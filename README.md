# 同层手机更新日志

## 2026-02-15

### 主要变更
- **整合合并**：将 `同层群聊6.html` 与 `好友列表.html` 的核心功能合并进 `同层私聊喵喵喵2.html`，形成单文件整合版。
- **群聊/私聊统一管理**：
  - 群聊与私聊共用同一套“联系人/群聊”面板与切换逻辑。
  - 新增（整合）群聊创建、成员管理与删除入口。
- **数据结构统一**：
  - 私聊写入 `<private>`，群聊写入 `<qunliao><multi>`，并整体封装在 `<shouji>` 中同步回 SillyTavern 聊天记录。
  - 兼容旧单会话格式（无私聊/群聊结构时仍可读取）。
- **好友/群聊导入导出**：
  - JSON 方式导入/导出好友与群聊；群聊仅追加，不覆盖已有记录。
- **状态与体验优化**：
  - 记忆上次会话模式（`tavern_chat_mode`），启动后自动恢复。

### 迁移提示
- 旧文件 `同层群聊6.html` 与 `好友列表.html` 可保留作为历史版本，但后续维护建议以 `同层私聊喵喵喵2.html` 为主。
- 如果在 SillyTavern 中运行，群聊/私聊数据会随聊天日志一起保存；若独立浏览器打开，则使用 localStorage 持久化。

- # 同层私聊喵喵喵2（整合版）README

## 简介
`同层私聊喵喵喵2.html` 是当前推荐的整合版单文件，已将 **群聊功能** 与 **好友列表功能** 合并到同一页面中，统一维护与使用。

## 主要特性
- 私聊/群聊统一入口与切换（联系人/群聊面板）。
- 群聊创建、成员管理、删除入口一体化。
- 好友列表导入/导出（JSON）。
- 同层朋友圈（Moments）、音乐面板、截图、语音/表情等常用扩展功能。

## 快速开始（SillyTavern 内）
1. 确保在 SillyTavern 中加载该 HTML（常见做法：iframe 或直接嵌入）。
2. 打开页面后，点击右上角“联系人/群聊”按钮进入列表。
3. 在“私聊好友 / 群聊”之间切换并创建会话。

> 若在浏览器独立打开，功能仍可使用，但数据仅保存到 localStorage，无法写入 SillyTavern 本地聊天记录。

## 数据存储说明
- **SillyTavern 环境下**：
  - 私聊内容写入 `<private>`
  - 群聊内容写入 `<qunliao><multi>`
  - 统一封装在 `<shouji>` 中，通过 `setChatMessages` 写回聊天日志
- **本地兜底**：使用 localStorage 作为备份与独立模式存储。
  - `tavern_chat_mode`：记忆上次会话模式
  - `tavern_friends_{source}_{id}`：按角色区分的好友列表

## 与旧文件的关系
- 原 `同层群聊6.html` 与 `好友列表.html` 已整合入本文件。
- 建议后续维护与使用以 `同层私聊喵喵喵2.html` 为准，旧文件可保留作历史版本。

## 备注
如果需要将群聊单独导出为文件或写入 SillyTavern 指定目录，可继续扩展后端/插件接口。
